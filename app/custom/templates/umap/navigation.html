{% load i18n %}

<nav class="umap-nav">
  <section>
    {% include "umap/branding.html" %}
  </section>
  <section>
    <ul>
      {% if AUTH_PROVIDER == 'hanko' %}
        {# Hanko SSO Mode #}
        {% if hanko_authenticated %}
          {# User is authenticated with Hanko - show dashboard #}
          <li>
            <a href="{% url 'user_dashboard' %}">{% trans "Dashboard" %}</a>
          </li>
          {% if hanko_django_user %}
            {# Has mapping to Django user - show starred maps #}
            <li>
              <a href="{{ hanko_django_user.get_stars_url }}">{% trans "Starred maps" %}</a>
            </li>
          {% endif %}
          {# Hanko auth web component (handles profile dropdown with Sign Out) #}
          <li>
            <hotosm-auth
              hanko-url="{{ HANKO_API_URL }}"
              redirect-after-login="{{ SITE_URL }}"
              redirect-after-logout="{{ SITE_URL }}"
              mapping-check-url="/api/v1/auth/status/"
              app-id="umap"
              {% if hanko_django_user %}display-name="{{ hanko_django_user.username }}"{% elif hanko_user %}display-name="{{ hanko_user.email }}"{% endif %}
            ></hotosm-auth>
          </li>
        {% else %}
          {# Not authenticated - show login link #}
          <li>
            <a href="{% url 'login' %}" class="login">{% trans "Log in" %}</a>
          </li>
        {% endif %}
      {% else %}
        {# Legacy Django/OSM Login #}
        {% if user.is_authenticated %}
          <li>
            <a href="{% url 'user_dashboard' %}">{% trans "My Dashboard" %} ({{ user }})</a>
          </li>
          <li>
            <a href="{{ user.get_stars_url }}">{% trans "Starred maps" %}</a>
          </li>
        {% else %}
          <li>
            <a href="{% url 'login' %}" class="login">{% trans "Log in" %} / {% trans "Sign in" %}</a>
          </li>
        {% endif %}
      {% endif %}

      {% if AUTH_PROVIDER != 'hanko' and user.is_authenticated %}
        {% if user.has_usable_password %}
          <li>
            <a href="{% url 'password_change' %}">{% trans "Change password" %}</a>
          </li>
        {% endif %}
        <li>
          <a href="{% url 'logout' %}" class="logout">{% trans "Log out" %}</a>
        </li>
      {% endif %}

      {% if not UMAP_READONLY %}
        <li>
          <a href="/chatmap">{% trans "Upload (ChatMap)" %}</a>
        </li>
        <li>
          <a href="{% url 'map_new' %}" class="button button-primary">{% trans "Create a map" %}</a>
        </li>
      {% endif %}
    </ul>
  </section>
</nav>
